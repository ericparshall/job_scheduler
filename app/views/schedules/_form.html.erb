<script type="text/javascript">
(function(angular) {
  
  
})(window.angular);
</script>
<div ng-app="schedulerApp" ng-controller="scheduleEditController" ng-cloak class="ng-cloak" ng-show="schedule.$resolved">

  <div class="alert alert-danger" ng-show="schedule.errors.length > 0">
    <ul>
      <li ng-repeat="error in schedule.errors"><div ng-bind-html="error"></div></li>
    </ul>
  </div>
  <div class="alert alert-warning" ng-show="schedule.warnings.length > 0">
    <ul>
      <li ng-repeat="warning in schedule.warnings"><div ng-bind-html="warning"></div></li>
    </ul>
  </div>
  <div class="row">
    <div class="col-md-8">
      <label>Job:</label>
        <angucomplete id="schedule_job"
          placeholder="Job"
          pause="100"
          selectedobject="schedule.job"
          localdata="jobs"
          searchfields="name"
          titlefield="name"
          minlength="1"
          inputclass="form-control"
          holderclass="input-group"
          buttonposition="right"
          buttonlabel="Job"
          holderclass="input-group">
        </angucomplete>
      <br />
      <div ng-if="schedule.persisted()" ng-cloak class="ng-cloak">
        User: {{schedule.user.full_name}}
      </div>
      <div ng-if="!schedule.persisted()" ng-cloak class="ng-cloak">
        <label>Employee:</label>
        <angucomplete id="schedule_user"
          placeholder="Employee"
          pause="100"
          selectedobject="schedule.user"
          localdata="users"
          searchfields="full_name"
          titlefield="full_name"
          minlength="1"
          inputclass="form-control"
          holderclass="input-group"
          buttonposition="right"
          buttonlabel="Employee"
          holderclass="input-group"
          on-selected="onUserSelected">
        </angucomplete>
      </div>
      <br >
      <div class="row">
        <div class="col-md-4">
          <label>From Time: </label>
        </div>
        <div class="col-md-4">
          <label>To Time: </label>
        </div>
      </div>
      
      <div class="row" ng-repeat="time_range in schedule.time_ranges">
        <div class="col-md-4 dropdown">
          <a class="dropdown-toggle" ng-attr-id="from_time_dropdown_{{$index}}" role="button" data-toggle="dropdown" data-target="#" href="#">
            <div class="input-group">
              <div class="form-control" style="font-size: 12px">{{time_range.from_time.format("ddd, DD MMM YYYY - hh:mm A")}}</div>
              <span class="input-group-addon">
                <i class="glyphicon glyphicon-calendar"></i>
              </span>
            </div>
          </a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
            <datetimepicker data-ng-model="time_range.from_time" data-on-set-time="schedule.validateNewSchedule(schedule, usersSelected)" data-datetimepicker-config="{ dropdownSelector: '#from_time_dropdown_{{$index}}' }"/>
          </ul>
        </div>
        <div class="col-md-4 dropdown">
          <a class="dropdown-toggle" ng-attr-id="to_time_dropdown_{{$index}}" role="button" data-toggle="dropdown" data-target="#" href="#">
            <div class="input-group">
              <div class="form-control" style="font-size: 12px">{{time_range.to_time.format("ddd, DD MMM YYYY - hh:mm A")}}</div>
              <span class="input-group-addon">
                <i class="glyphicon glyphicon-calendar"></i>
              </span>
            </div>
          </a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
            <datetimepicker data-ng-model="time_range.to_time" data-on-set-time="schedule.validateNewSchedule(schedule, usersSelected)" data-datetimepicker-config="{ dropdownSelector: '#to_time_dropdown_{{$index}}' }"/>
          </ul>
        </div>
        <div class="col-md-4"><span style="float: left">{{time_range.getTotalHoursLabel()}}</span><a href="#" style="float: right" ng-show="$index > 0" ng-click="schedule.time_ranges.splice($index, 1)">remove</a></div>
      </div>
      <br />
      <div ng-show="!schedule.persisted() &amp;&amp; !schedule.expanded">
        <div class="row">
          <div class="col-md-12">
            <label>Repeat schedule through:</label>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4 dropdown">
            <a class="dropdown-toggle" id="through_date_dropdown_0" role="button" data-toggle="dropdown" data-target="#" href="#">
              <div class="input-group">
                <div class="form-control" style="font-size: 12px">{{schedule.time_ranges[0].through_date.format("dddd, DD MMM YYYY")}}</div>
                <span class="input-group-addon">
                  <i class="glyphicon glyphicon-calendar"></i>
                </span>
              </div>
            </a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
              <datetimepicker data-ng-model="schedule.time_ranges[0].through_date" data-on-set-time="schedule.validateNewSchedule(schedule, usersSelected)" data-datetimepicker-config="{ dropdownSelector: '#through_date_dropdown_0', minView: 'day' }"/>
            </ul>
          </div>
          <div class="col-md-4">
            <a href="#" class="btn btn-sm btn-primary" role="button" style="color: #FFFFFF" ng-click="schedule.expandTimeRanges()" ng-disabled="!schedule.canExpand()">Customize Times by Day</a>
          </div>
        </div>
      </div>

      <%= hidden_field_tag :return_path, params[:return_path] %>
      <%= hidden_field_tag :future_schedule_id, params[:future_schedule_id] %>
    </div>
    <div class="col-md-4" style="padding-top: 15px; padding-bottom: 15px">
        <div ng-repeat="user in usersSelected" ng-attr-id="selected_user_{{user.id}}" style="row">
          <div style='float: left'>{{user.full_name}}</div>
          <div style='float: right'><a href="#" ng-click="removeSelectedUser(user)">remove</a></div>
          <div style='clear: both'></div>
        </div>
    </div>
  </div>
  <br>

  <div class="row" ng-show="!schedule.persisted()">
    <div class="col-md-4">
      <button ng-disabled="disableSubmitButtons" ng-click="saveSchedule()" class="btn btn-lg btn-primary btn-block">Create</button>
    </div>
  </div>
  <div class="row" ng-show="schedule.persisted()">
    <div class="col-md-4">
      <button ng-disabled="disableSubmitButtons" ng-click="saveSchedule()" class="btn btn-lg btn-primary btn-block">Update</button>
    </div>
  </div>
  <br>
  <div class="row" ng-show="!schedule.persisted() &amp;&amp; !schedule.expanded &amp;&amp; !schedule.isPendingSchedule()">
    <div class="col-md-4">
      <button ng-disabled="disableSubmitButtons" ng-click="createPendingSchedule()" class="btn btn-lg btn-primary btn-block">Create Pending Schedule</button>
    </div>
  </div>

  <div class="row" ng-show="!schedule.persisted() &amp;&amp; !schedule.expanded &amp;&amp; schedule.isPendingSchedule()">
    <div class="col-md-4">
      <button ng-disabled="disableSubmitButtons" ng-click="updatePendingSchedule()" class="btn btn-lg btn-primary btn-block">Update Pending Schedule</button>
    </div>
  </div>
  <br>
  <div class="row" ng-show="!schedule.persisted() &amp;&amp; !schedule.expanded &amp;&amp; schedule.isPendingSchedule()">
    <div class="col-md-4">
      <button ng-disabled="disableSubmitButtons" ng-click="deletePendingSchedule()" class="btn btn-lg btn-primary btn-block">Delete Pending Schedule</button>
    </div>
  </div>
</div>


<br />
