<script type="text/javascript">
$(function() {
  $("input[name='from_date']").datepicker();
  $("input[name='to_date']").datepicker();
  $("input[name='from_date']").click(function() { 
    $("table.ui-datepicker-calendar a.ui-state-default").click(function() { $("#unit").val(""); }); 
    $("a.ui-datepicker-next").click(function() { $("#unit").val(""); });
    $("a.ui-datepicker-prev").click(function() { $("#unit").val(""); });
  });
  $("input[name='to_date']").click(function() { 
    $("table.ui-datepicker-calendar a.ui-state-default").click(function() { $("#unit").val(""); }); 
    $("a.ui-datepicker-next").click(function() { $("#unit").val(""); });
    $("a.ui-datepicker-prev").click(function() { $("#unit").val(""); });
  });
  
  $("#remove_user_filter").button({ icons: { primary: "ui-icon-cancel" } });
  $("#remove_job_filter").button({ icons: { primary: "ui-icon-cancel" } });
  $("#remove_user_filter").click(function() { $("#user_id").val(""); $("#schedule_search_form input[name='commit']").click(); });
  $("#remove_job_filter").click(function() { $("#job_id").val(""); $("#schedule_search_form input[name='commit']").click(); });
  
  $("#date_range_today").click(function() {
    $("input[name='from_date']").val("<%= Date.today %>");
    $("input[name='to_date']").val("<%= Date.today %>");
    $("#unit").val("today"); 
    $("#schedule_search_form input[name='commit']").click(); 
  });
  $("#date_range_month").click(function() { 
    $("input[name='from_date']").val("<%= Date.today %>");
    $("input[name='to_date']").val("<%= Date.today %>");
    $("#unit").val("month"); 
    $("#schedule_search_form input[name='commit']").click(); 
  });
  $("#date_range_week").click(function() { 
    $("input[name='from_date']").val("<%= Date.today %>");
    $("input[name='to_date']").val("<%= Date.today %>");
    $("#unit").val("week"); 
    $("#schedule_search_form input[name='commit']").click(); 
  });
  $("#date_range_day").click(function() { 
    $("input[name='from_date']").val("<%= Date.today %>");
    $("input[name='to_date']").val("<%= Date.today %>");
    $("#unit").val("day"); 
    $("#schedule_search_form input[name='commit']").click(); 
  });
  
  <% unless params[:unit].blank? %>
  $("#page_back_date").click(function() { 
    $("#from_date").val("<%= page_back_dates[0] %>");
    $("#to_date").val("<%= page_back_dates[1] %>");
    if ($("#unit").val() == "today") {
      $("#unit").val("day");
    }
    $("#schedule_search_form input[name='commit']").click(); 
  });
  
  $("#page_forward_date").click(function() { 
    $("#from_date").val("<%= page_forward_dates[0] %>");
    $("#to_date").val("<%= page_forward_dates[1] %>");
    if ($("#unit").val() == "today") {
      $("#unit").val("day");
    }
    $("#schedule_search_form input[name='commit']").click(); 
  });
  <% end %>
});
</script>

<%= form_tag(schedules_search_path, method: :get, id: "schedule_search_form") do %>
<table class="fc-header" style="width: 100%">
  <tbody>
    <tr>
      <td class="fc-header-left">
        
        <div class="horizontal-form">
          <div class="field" style="width: 75px">
            <%= @from_date.strftime('%A') %>&nbsp;
          </div>
          <div class="field">
            <div style="float: left"><%= text_field_tag :from_date, @from_date, style: "width: 80px" %></div>
          </div>
          <div class="field" style="width: 75">
            <%= @to_date.strftime('%A') %>&nbsp;
          </div>
          <div class="field">
            <div style="float: left"><%= text_field_tag :to_date, @to_date, style: "width: 80px" %></div>
          </div>
          <%= hidden_field_tag :job_id, params[:job_id] %>
          <%= hidden_field_tag :user_id, params[:user_id] %>
          <%= hidden_field_tag :unit, params[:unit] %>
          <div class="field">
            <%= submit_tag "Go" %>
          </div>
        </div>
        
      </td>
      <td class="fc-header-right">
        <span id="date_range_today" class="fc-button fc-button-today fc-state-default fc-corner-left <%= params[:unit] == "today" ? "fc-state-active" : "" %>" unselectable="on">today</span>
        <span id="date_range_month" class="fc-button fc-button-month fc-state-default <%= params[:unit] == "month" ? "fc-state-active" : "" %>" unselectable="on">month</span>
        <span id="date_range_week" class="fc-button fc-button-agendaWeek fc-state-default <%= params[:unit] == "week" ? "fc-state-active" : "" %>" unselectable="on">week</span>
        <span id="date_range_day" class="fc-button fc-button-agendaDay fc-state-default fc-corner-right <%= params[:unit] == "day" ? "fc-state-active" : "" %>" unselectable="on">day</span>
        <% unless params[:unit].blank? %>
        <span id="page_back_date" class="fc-button fc-button-prev fc-state-default fc-corner-left" unselectable="on">
          <span class="fc-text-arrow">‹</span>
        </span>
        <span id="page_forward_date" class="fc-button fc-button-next fc-state-default fc-corner-right" unselectable="on">
          <span class="fc-text-arrow">›</span>
        </span>
        <% end %>
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <% if @user %><button id="remove_user_filter"><%= @user.full_name %></button><% end %>
        <% if @job %><button id="remove_job_filter"><%= @job.name %></button><% end %>
      </td>
    </tr>
  </tbody>
</table>
<% end %>
